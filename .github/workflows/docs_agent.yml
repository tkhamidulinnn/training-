name: ðŸ¤– Documentation Agent (Gemini)

on:
  pull_request:
    types: [opened, synchronize, labeled]
  workflow_dispatch:
    inputs:
      mode:
        description: 'Scan Mode'
        required: true
        default: 'diff'
        type: choice
        options:
        - diff
        - full_scan

permissions:
  pull-requests: write
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Check out code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.ref }}
          fetch-depth: 0

      - name: 2. Gather Data (Hybrid Mode)
        id: file_data
        run: |
          git fetch origin ${{ github.base_ref }} || true
          
          # ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Ñ€ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
          MODE="${{ github.event.inputs.mode }}"
          if [ "${{ github.event_name }}" == "pull_request" ]; then
             MODE="diff"
          fi
          
          echo "ðŸš€ Running in mode: $MODE"

          if [ "$MODE" == "diff" ]; then
             # Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼: Ð°Ð½Ð°Ð»Ð¸Ð· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
             git diff origin/${{ github.base_ref }} HEAD -- . ":(exclude).github" ":(exclude).gitignore" > pr_diff.txt
          
          elif [ "$MODE" == "full_scan" ]; then
             # Ð ÐµÐ¶Ð¸Ð¼ ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚Ð¾Ñ€Ð°: Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼ Ð²ÐµÑÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚
             echo "Reading all critical source files..."
             # ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ñ„Ð°Ð¹Ð»Ñ‹ ÐºÐ¾Ð´Ð°, Ð¸ÑÐºÐ»ÑŽÑ‡Ð°Ñ Ð¼ÑƒÑÐ¾Ñ€
             find . -maxdepth 4 -not -path '*/.*' -not -path './node_modules*' -not -path './venv*' -not -path './__pycache__*' | grep -E "\.(py|js|ts|go|java|md|json|yml|yaml)$" > all_files_list.txt
             
             echo "FULL REPOSITORY SCAN:" > pr_diff.txt
             while read file; do
               echo "--- FILE: $file ---" >> pr_diff.txt
               cat "$file" >> pr_diff.txt
               echo -e "\n" >> pr_diff.txt
             done < all_files_list.txt
          fi

          if
